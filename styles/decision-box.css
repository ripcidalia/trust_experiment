/* ==========================================================================
   decision-box.css
   Purpose: Styles for the in-task decision interface shown near the doors.
   Behavior:
   - Expands/collapses to reveal choices or compact integrity-only mode.
   - Uses smooth transitions, glow effects, and subtle motion feedback.
   - JS controls visibility via classes (e.g., .hud-show, .expanded, .compact).
   ========================================================================== */

/* ===== 1) Base container ===== */
#decision-box {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  transform-origin: 50% 100%; /* anchored at bottom center for expansion */

  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: 10px;
  padding: 12px 14px;

  /* Visual style: translucent HUD panel */
  background: rgba(12, 16, 24, 0.68);
  color: #d9e6ff;
  border: 1px solid rgba(120, 180, 255, 0.25);
  border-radius: 12px;
  backdrop-filter: blur(6px);

  /* Subtle glow and depth */
  --glow-color: hsl(205 90% 60% / 0.25);
  --glow-strong-color: hsl(205 90% 60% / 0.45);
  box-shadow:
    0 12px 40px rgba(0, 0, 0, 0.35),
    inset 0 0 0 1px rgba(255, 255, 255, 0.04),
    0 0 16px 4px var(--glow-color);

  z-index: 50;
  width: min(520px, 92vw);

  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  overflow: hidden;
  will-change: max-height, opacity, transform;

  /* Default collapsed state */
  max-height: 999px;
  transition:
    box-shadow 140ms linear,
    opacity 220ms ease,
    transform 220ms ease,
    max-height 260ms cubic-bezier(.2, .9, .1, 1),
    visibility 0s linear 220ms;
}

/* ===== 2) Visibility / animation states ===== */

/* Fully visible and interactive */
#decision-box.hud-show {
  opacity: 1;
  transform: translateX(-50%);
  visibility: visible;
  pointer-events: auto;
  transition:
    opacity 220ms ease,
    transform 220ms ease,
    max-height 260ms cubic-bezier(.2, .9, .1, 1),
    visibility 0s;
}

/* Closing animation — fades + slight tilt down */
#decision-box.hud-closing {
  opacity: 0;
  transform: translateX(-50%) translateY(6px) scale(0.985);
  transition:
    opacity 220ms ease,
    transform 220ms ease,
    max-height 200ms ease;
}

/* Allow fade-out to complete cleanly */
#decision-box.hud-show.hud-closing {
  visibility: visible;
}

/* ===== 3) Compact / Expanded modes ===== */

/* Compact = integrity bar only */
#decision-box.compact {
  max-height: 64px;
}

/* Expanded = full text + controls */
#decision-box.expanded {
  max-height: 320px;
}

/* ===== 4) Content reveal transitions ===== */
#decision-box .decision-controls,
#decision-box #decision-text {
  overflow: hidden;
  max-height: 0;
  opacity: 0;
  transform: translateY(-6px) scale(0.98);
  transition:
    max-height 320ms cubic-bezier(.2, .9, .1, 1),
    opacity 260ms ease,
    transform 320ms cubic-bezier(.2, .9, .1, 1);
  will-change: max-height, opacity, transform;
}

/* Reveal smoothly when expanded */
#decision-box.expanded .decision-controls,
#decision-box.expanded #decision-text {
  max-height: 500px;
  opacity: 1;
  transform: translateY(0) scale(1);
}

/* Optional small stagger for smoother unfolding */
#decision-box.reveal-stagger.expanded #decision-text {
  transition-delay: 0ms;
}

#decision-box.reveal-stagger.expanded .decision-controls {
  transition-delay: 60ms;
}

/* Reduced motion accessibility */
@media (prefers-reduced-motion: reduce) {
  #decision-box,
  #decision-box.hud-show {
    transition: none;
    transform: translateX(-50%);
  }
}

/* ===== 5) Text label styling ===== */
#decision-box p {
  margin: 0 0 6px 0;
  font-size: 15px;
  font-weight: 600;
  letter-spacing: 0.2px;
  color: #b6c7e6;
  text-align: center;
}

/* ===== 6) Buttons ===== */
#decision-box .primaryBtn,
#decision-box .secondaryBtn {
  appearance: none;
  width: 100%;
  padding: 12px 18px;
  font-size: 16px;
  font-weight: 700;
  border-radius: 10px;
  cursor: pointer;

  background: radial-gradient(
    120% 120% at 50% 0%,
    rgba(43, 129, 255, 0.22),
    rgba(43, 129, 255, 0.06)
  );
  color: #d9e6ff;
  border: 1px solid rgba(12, 23, 39, 0.55);
  box-shadow: 0 4px 14px rgba(0, 0, 0, 0.12);
  transition: transform 0.04s ease, filter 0.15s ease,
    background 0.15s ease, border-color 0.15s ease;
}

/* Compact layout adjustments for small screens */
@media (max-width: 680px) {
  #decision-box {
    gap: 8px;
    padding: 10px 12px;
  }
}

/* Hover / active / focus feedback */
#decision-box .primaryBtn:hover,
#decision-box .secondaryBtn:hover {
  filter: brightness(1.08);
}

#decision-box .primaryBtn:active,
#decision-box .secondaryBtn:active {
  transform: translateY(1px);
}

#decision-box .primaryBtn:focus-visible,
#decision-box .secondaryBtn:focus-visible {
  outline: 2px solid rgba(120, 180, 255, 0.65);
  outline-offset: 2px;
}

/* ===== 7) Environmental Integrity meter ===== */
.env-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

.env-label {
  font-size: 13px;
  font-weight: 700;
  letter-spacing: 0.2px;
  color: #b6c7e6;
  white-space: nowrap;
}

.env-wrap {
  position: relative;
  flex: 1;
  height: 14px;
  border-radius: 999px;
  background: rgba(180, 200, 235, 0.15);
  box-shadow: inset 0 0 0 1px rgba(120, 180, 255, 0.18);
  overflow: hidden;
}

.env-fill {
  position: absolute;
  inset: 0;
  width: 100%;
  transform-origin: left center;
  transform: scaleX(1); /* JS animates this (1 → 0) */
  background: hsl(205 70% 50%);
  transition: filter 140ms ease;
}

.env-pct {
  font-variant-numeric: tabular-nums;
  font-size: 12px;
  font-weight: 700;
  opacity: 0.85;
  min-width: 3ch;
  text-align: right;
}

/* ===== 8) Pulse animations ===== */

/* Subtle integrity pulse when environment < ~30% */
@keyframes envPulse {
  0% {
    filter: brightness(1) saturate(1);
  }
  50% {
    filter: brightness(1.12) saturate(1.06);
  }
  100% {
    filter: brightness(1) saturate(1);
  }
}

.env-fill.pulse {
  animation: envPulse 900ms ease-in-out infinite;
}

/* Decision-box glow heartbeat (linked to env red zone) */
@keyframes boxHeartbeat {
  0%,
  100% {
    box-shadow:
      0 12px 40px rgba(0, 0, 0, 0.35),
      inset 0 0 0 1px rgba(255, 255, 255, 0.04),
      0 0 0 0 var(--glow-strong-color);
  }
  50% {
    box-shadow:
      0 12px 40px rgba(0, 0, 0, 0.45),
      inset 0 0 0 1px rgba(255, 255, 255, 0.05),
      0 0 28px 10px var(--glow-strong-color);
  }
}

#decision-box.heartbeat {
  animation: boxHeartbeat var(--hb-period, 900ms) ease-in-out infinite;
}

/* Respect user motion preferences */
@media (prefers-reduced-motion: reduce) {
  #decision-box.heartbeat {
    animation: none;
  }
}
