/* ==========================================================================
   drone.css
   Purpose: Visual and motion styling for the in-scene drone overlay.
   Notes:
   - The container’s position/size is set from JS; CSS handles presentation.
   - Hover motion is driven via a CSS variable (--hoverY) animated by keyframes.
   - Rotor discs spin independently so the parent perspective stays stable.
   ========================================================================== */

/* ===== 1) Drone container (positioning + 3D context) ===== */
.overlay-drone {
  position: absolute;
  z-index: 4;
  user-select: none;
  -webkit-user-drag: none;
  visibility: visible;
  pointer-events: none;

  /* Hover amplitude (px) — JS may override per scene */
  --hover-amp: 8px;

  display: inline-block;
  perspective: 800px;

  /* Compose base offsets from JS with vertical hover drift */
  transform: translate3d(var(--tx, 0px), var(--ty, 0px), 0)
             translateY(var(--hoverY, 0px));
  will-change: transform;
  transition: none;
}

/* Body image scales with container dimensions from JS */
.overlay-drone .drone-body {
  display: block;
  width: 100%;
  height: auto;
}

/* ===== 2) Rotors (keep perspective on the parent) =====
   Each rotor is a flat, slightly squashed ellipse to read from eye level.
   The parent rotor element holds perspective; only the inner disc spins.
*/
.overlay-drone .rotor {
  position: absolute;
  width: 23%;
  height: 5%;
  top: 3.8%;
  pointer-events: none;
  transform-origin: 50% 50%;
  transform: rotateX(72deg) scaleY(0.9);
}

/* Side placement/yaw */
.overlay-drone .rotor-left {
  left: 26.6%;
  transform: rotateX(72deg) rotateY(0deg) scaleY(0.9);
}
.overlay-drone .rotor-right {
  right: 26.6%;
  transform: rotateX(72deg) rotateY(0deg) scaleY(0.9);
}

/* ===== 3) Rotor disc (visual mass + spin) ===== */
.overlay-drone .rotor .disc {
  position: relative;
  width: 100%;
  height: 100%;
  border-radius: 50%;

  opacity: 1;
  filter: blur(3px);
  mix-blend-mode: normal;

  /* Dense, slightly glossy layered look */
  background:
    radial-gradient(ellipse at center,
      rgba(235, 245, 255, 0.9) 18%,
      rgba(200, 220, 255, 0.85) 45%,
      rgba(170, 195, 245, 0.75) 70%,
      rgba(130, 160, 230, 0.6) 85%,
      rgba(80, 100, 150, 0.4) 95%
    ),
    linear-gradient(to bottom, rgba(255, 255, 255, 0.15), rgba(0, 0, 0, 0.1)),
    #7382a8;

  box-shadow:
    inset 0 0 0 1px rgba(255, 255, 255, 0.45),
    inset 0 0 12px rgba(200, 220, 255, 0.45),
    0 0 6px rgba(80, 100, 160, 0.35);

  /* Spin only the disc (child), not the rotor wrapper */
  animation: propSpin 58ms linear infinite;
}

/* Blade streaks that ride with the rotation */
.overlay-drone .rotor .disc::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 50%;
  background:
    conic-gradient(
      from 0deg,
      rgba(255, 255, 255, 0.35) 0 6deg, transparent 6deg 24deg,
      rgba(255, 255, 255, 0.35) 24deg 30deg, transparent 30deg 48deg,
      rgba(255, 255, 255, 0.35) 48deg 54deg, transparent 54deg 72deg,
      rgba(255, 255, 255, 0.35) 72deg 78deg, transparent 78deg 96deg
    );
  filter: blur(0.6px);
  opacity: 0.7;
}

/* Rotor hub for physical readability */
.overlay-drone .rotor .disc::after {
  content: "";
  position: absolute;
  left: 50%;
  top: 50%;
  width: 22%;
  height: 22%;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  background: radial-gradient(circle at 48% 52%, #e6eeff 0%, #a9b8e6 60%, #7c8bb3 100%);
  box-shadow:
    0 0 2px rgba(0, 0, 0, 0.5),
    inset 0 0 3px rgba(255, 255, 255, 0.6);
  opacity: 0.95;
}

/* ===== 4) Animations ===== */

/* Rotor disc spin */
@keyframes propSpin {
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}

/* Idle hover: drives var(--hoverY) used in the container transform */
.overlay-drone.hovering {
  animation: droneHover var(--hover-period, 1600ms) ease-in-out infinite;
  animation-fill-mode: both;
}

/* Pause hover during explicit JS-driven motion */
.overlay-drone.hovering.paused {
  animation-play-state: paused;
}

@keyframes droneHover {
  0%   { --hoverY: 0px; }
  50%  { --hoverY: var(--hover-amp, 4px); }
  100% { --hoverY: 0px; }
}
